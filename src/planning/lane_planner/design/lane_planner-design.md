Lane planner {#lane-planner}
===========

This is the design document for the `lane_planner` package.

# Purpose / Use cases
Lane Planner is used to calculate trajectory within lanes.
It will use centerline of lanes obtained from HADMap and convert it into trajectory.

# Design

## Assumptions / Known limits

Assumptions:
* Route message does not include primitive that is irrelevant.<br>
  e.g. if lane are connected as 1->2->3, and if start_pose is within lane 2 and goal_pose is lane 3, given route should not include lane 1.

Limitations:
* Since the lane planner is using centerline of lane, it may not be kinematically feasible path, for example, when the lanes have sharp turns.

* Optimization of trajectories with vehicle's limitations will be future work.

## Inputs / Outputs / API
Inputs
* HADMap
* Route via ActionGoalRequest

Outputs
* Trajectory via ActionResult  


## Inner-workings / Algorithms
Trajectory is generated by following steps:
1. Generation of trajectory points from centerline in Lanelet Map
2. Calculation of steering angle from curvature of the path
3. Calcuation of time of arrival for each points from velocity
4. Resizing trajectory to fit within trajectory capacity
5. Smoothing of velocity

## Error detection and handling
If any invalid route is given, the planner will return empty trajectory.

# Security considerations
<!-- Required -->
<!-- Things to consider:
- Spoofing (How do you check for and handle fake input?)
- Tampering (How do you check for and handle tampered input?)
- Repudiation (How are you affected by the actions of external actors?).
- Information Disclosure (Can data leak?).
- Denial of Service (How do you handle spamming?).
- Elevation of Privilege (Do you need to change permission levels during execution?) -->


# References / External links
<!-- Optional -->


# Future extensions / Unimplemented parts
* Optimization of the shape of the path using drivable area from lane geometry
* Velocity optimization with vehicle's jerk/acceleration/velocity limits

# Related issues
<!-- Required -->
